---
import "../styles/global.css";
import Footer from '@components/Footer.astro';
import Sidebar from '@components/Sidebar.astro';
import Sp from '@components/Sp.astro';
import Sns from '@components/Sns.astro';
import { undefined } from "astro:schema";
const { frontmatter } = Astro.props;
const{ minutesRead } = Astro.props.frontmatter;
const isPodcast = Astro.url.pathname.startsWith("/podcast/");
const isProfile = Astro.url.pathname.startsWith("/profile/");
const canonicalURL = new URL(Astro.url.pathname, 'https://naomina121.com');
const ogpImageURL = isPodcast ? new URL('/obsidean_onsei.jpg', canonicalURL) : new URL(frontmatter.image.url, canonicalURL);
const websiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "naomina121",
  "url": "https://naomina121.com",
  "description": "ãƒŠã‚ªã®å…¬å¼ã‚µã‚¤ãƒˆã§ã™ã€‚ãƒ–ãƒ­ã‚°ã€éŸ³å£°ãƒ–ãƒ­ã‚°ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã€æ´»å‹•æ‹ ç‚¹ãªã©ã®æƒ…å ±ã‚’ç™ºä¿¡ã—ã¦ã„ã¾ã™ã€‚",
};
  const siteUrl = "https://naomina121.com";
  let title = frontmatter.title;
  let pageSchema = {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": title,
    "description": frontmatter.description,
    "image": ogpImageURL.toString(),
    "url": canonicalURL.toString(),
    "datePublished": new Date(frontmatter.pubDate).toISOString(),
    "dateModified": frontmatter.modDate
    ? new Date(frontmatter.modDate).toISOString()
    : new Date(frontmatter.pubDate).toISOString(),
    "author": {
      "@type": "Person",
      "name": frontmatter.author,
    },
    "publisher": {
      "@type": "Organization",
      "name": "naomina121",
      "logo": {
        "@type": "ImageObject",
        "url": siteUrl ? new URL('/images/blog2.webp', siteUrl).toString() : undefined,
      }
    }
  };
---
<!doctype html>
<html lang="ja">
  <head prefix="og: http://ogp.me/ns#">
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VGYCVR3R5F"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-VGYCVR3R5F');
</script>
<script src="https://kit.fontawesome.com/3ba6930b7b.js" crossorigin="anonymous"></script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <link rel="sitemap" href="/sitemap-index.xml" />
    <link rel="canonical" href={canonicalURL.toString()}>
    <meta property="og:title" content={frontmatter.title} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL.toString()} />
    <meta property="og:image" content={ogpImageURL.toString()} />
    <meta property="og:description" content={frontmatter.description} />
    <meta property="og:site_name" content="naomina121" />
    <meta property="og:locale" content="ja_JP" />
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@naomina121">
    <meta name="twitter:title" content={frontmatter.title}>
    <meta name="twitter:description" content={frontmatter.description}>
    <meta name="twitter:image" content={ogpImageURL.toString()}>
    <script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />
    {pageSchema && (
      <script type="application/ld+json" set:html={JSON.stringify(pageSchema)} />
    )}
    <title>{frontmatter.title} | NAOMINA121</title>
  </head>
  <body>
    <div class="flex flex-col h-full min-h-screen">
    <div class="container flex justify-between items-start align-top mx-auto max-w-[1200px]">
    <Sp/>
    <Sidebar />
    <main id="article-body" class="w-full max-w-6xl bg-[#1e1e1e] pb-[60px] px-16 border-l-[1px] border-[#3c3c3c]">
    <h1> {frontmatter.title}</h1>
    <ul class="tags mb-0 flex flex-wrap gap-2 my-0 w-full justify-end">
        {frontmatter.tags.map((item:string) => <li><a class="tag" href={`/tags/${item}`}>#{item}</a></li>)}
        <li class="mb-2 text-sm">ğŸ“°æŠ•ç¨¿æ—¥: {frontmatter.pubDate.toString().slice(0,10)}</li>
        {frontmatter.modDate && <li class="mb-2 text-sm">âœï¸æœ€çµ‚æ›´æ–°æ—¥: {frontmatter.modDate.toString().slice(0,10)}</li>}
    </ul>
    <p class="mt-0 mb-6 text-right text-sm">ğŸ“–è‘—è€…: {frontmatter.author}</p>
    {isPodcast ? null : <img src={frontmatter.image.url} class="w-full max-w-[820px] max-h-[500px] object-cover" alt={frontmatter.image.alt} />}
{!isPodcast && (minutesRead) &&
    <div class="timeCount my-6">
    <span class="timeCountTitle">
    ğŸ“– èª­äº†æ™‚é–“ç›®å®‰ï¼š
    </span>
    <span class="timeCountSpan">
        ã“ã®è¨˜äº‹ã¯èª­ã‚€ã®ã«ç´„ <span class="bold">{minutesRead}</span> ã‹ã‹ã‚Šã¾ã™ã€‚
    </span>
    </div>
  }
    <slot />
    {isProfile ? null :
    <Sns frontmatter={frontmatter} />
    }
    </main>
    </div>
        <Footer />
    </div>

{isPodcast && <script is:inline>
// ============================================
// ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
// ============================================
let player; // YouTubeãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
let transcriptData = []; // ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´
let currentTranscriptIndex = 0; // ç¾åœ¨ã®ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
let timeUpdateInterval = null; // æ™‚é–“æ›´æ–°ç”¨ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ID

// ============================================
// YOUTUBEAPI
// ============================================
let tag = document.createElement("script");
tag.src = "https://www.youtube.com/iframe_api";
let firstScriptTag = document.getElementsByTagName("script")[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

// ============================================
// APIæº–å‚™å®Œäº†æ™‚ã®å‡¦ç†
// ============================================
function onYouTubeIframeAPIReady() {
  // YouTubeã®å‹•ç”»IDã‚’å–å¾—
  const videoId = document.getElementById("player").getAttribute("data-id");

  if (!videoId) {
    return;
  }
  // frontmatterElãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
  const ytVideo = document.getElementById("player");
  if (!ytVideo) {
    return;
  }

  console.log(`Initializing player for video ID: ${videoId}`); // ãƒ­ã‚°è¿½åŠ 

  try {
    player = new YT.Player("player", {
      height: "360",
      width: "640",
      videoId: videoId,
      events: {
        // 'onReady'ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’è¿½åŠ 
        onReady: onPlayerReady,
        // çŠ¶æ…‹å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
        onStateChange: onPlayerStateChange,
      },
    });
    console.log("YT.Player object created."); // ãƒ­ã‚°è¿½åŠ 
  } catch (error) {
    console.error("Error creating YT.Player:", error); // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
  }
}

// ============================================
// ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼æº–å‚™å®Œäº†æ™‚ã®å‡¦ç†
// ============================================
function onPlayerReady(event) {
  console.log("Player is ready."); // ãƒ­ã‚°è¿½åŠ : ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼æº–å‚™å®Œäº†ã‚’ç¢ºèª
  // ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ãŒæº–å‚™ã§ãã¦ã‹ã‚‰ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
  setupChapterClickEvents();
  // ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®åˆæœŸåŒ–
  initializeTranscript();
  // ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã®ç›£è¦–ã‚’é–‹å§‹
  observeAccordion();
}

// ============================================
// ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼çŠ¶æ…‹å¤‰æ›´æ™‚ã®å‡¦ç†
// ============================================
function onPlayerStateChange(event) {
  if (event.data === YT.PlayerState.PLAYING) {
    // å†ç”Ÿé–‹å§‹æ™‚ã«ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æ›´æ–°ã‚’é–‹å§‹
    startTranscriptTracking();
  } else {
    // å†ç”Ÿåœæ­¢æ™‚ã«ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æ›´æ–°ã‚’åœæ­¢
    stopTranscriptTracking();
  }
}

// ============================================
// ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆé–¢é€£
// ============================================

// ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ‡ãƒ¼ã‚¿ã®åˆæœŸåŒ–
function initializeTranscript() {
  // HTMLã‹ã‚‰ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  const transcriptSource = document.getElementById("transcript-source");

  if (!transcriptSource) {
    console.warn("Transcript source element not found");
    return;
  }

  // è¤‡æ•°ã®å½¢å¼ã«å¯¾å¿œ
  const transcriptItems = transcriptSource.querySelectorAll(
    ".transcript-segment, [data-timestamp]",
  );

  if (transcriptItems.length > 0) {
    // ãƒ‡ãƒ¼ã‚¿å±æ€§å½¢å¼ã®å ´åˆ
    transcriptItems.forEach((item) => {
      const timestamp = item.getAttribute("data-timestamp");
      const text = item.textContent.trim();

      if (timestamp && text) {
        const seconds = timeToSeconds(timestamp);
        transcriptData.push({ time: timestamp, text, seconds });
      }
    });
  } else {
    // ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã®å ´åˆï¼ˆå¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ï¼‰
    const transcriptText = transcriptSource.textContent;
    const regex = /\((\d{2}:\d{2})\)\s*(.*?)(?=\(\d{2}:\d{2}\)|$)/gs;
    let match;

    while ((match = regex.exec(transcriptText)) !== null) {
      const time = match[1];
      const text = match[2].trim();
      const seconds = timeToSeconds(time);
      transcriptData.push({ time, text, seconds });
    }
  }

  console.log("Transcript data initialized:", transcriptData);
}

// ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚³ãƒ³ãƒ†ãƒŠã®ä½œæˆ
function createTranscriptContainer() {
  // æ—¢å­˜ã®ã‚³ãƒ³ãƒ†ãƒŠãŒã‚ã‚Œã°å‰Šé™¤
  const existingContainer = document.getElementById("transcript-container");
  if (existingContainer) {
    existingContainer.remove();
  }

  // HTMLã‚’ä½œæˆ
  const html = `
    <div id="transcript-container" style="display: none;">
      <div id="transcript-box">
        <div id="transcript-content"></div>
      </div>
    </div>
  `;

  // ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã®å¾Œã«æŒ¿å…¥
  const accordion = document.querySelector(".transcript-accordion");
  if (accordion) {
    accordion.insertAdjacentHTML("afterend", html);
  }

  // ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å†…å®¹ã‚’ç”Ÿæˆ
  const contentDiv = document.getElementById("transcript-content");
  transcriptData.forEach((item, index) => {
    const p = document.createElement("p");
    p.className = "transcript-item";
    p.setAttribute("data-index", index);
    p.setAttribute("data-seconds", item.seconds);
    p.innerHTML = `<span class="transcript-time">${item.time}</span> ${item.text}`;

    // ã‚¯ãƒªãƒƒã‚¯ã§è©²å½“ç®‡æ‰€ã«ã‚·ãƒ¼ã‚¯
    p.addEventListener("click", () => {
      if (player && typeof player.seekTo === "function") {
        player.seekTo(item.seconds, true);
      }
    });

    contentDiv.appendChild(p);
  });
}

// ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã®é–‹é–‰ã‚’ç›£è¦–
function observeAccordion() {
  // ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã®detailsè¦ç´ ã‚’å–å¾—
  const detailsElement = document.querySelector(".transcript-accordion");
  if (!detailsElement) {
    console.warn("Accordion element not found");
    return;
  }

  // toggleã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½¿ç”¨ï¼ˆã‚ˆã‚Šç¢ºå®Ÿï¼‰
  detailsElement.addEventListener("toggle", (event) => {
    const isOpen = event.target.open;
    console.log("Accordion toggled:", isOpen);
    handleAccordionToggle(isOpen);
  });

  // åˆæœŸçŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯
  if (detailsElement.hasAttribute("open")) {
    handleAccordionToggle(true);
  }
}

// ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã®é–‹é–‰æ™‚ã®å‡¦ç†
function handleAccordionToggle(isOpen) {
  console.log("handleAccordionToggle called with:", isOpen);

  const container = document.getElementById("transcript-container");

  if (isOpen) {
    console.log("Opening accordion...");
    // ã‚³ãƒ³ãƒ†ãƒŠãŒãªã‘ã‚Œã°ä½œæˆ
    if (!container) {
      console.log("Creating transcript container...");
      createTranscriptContainer();
      // ä½œæˆå¾Œã€è¡¨ç¤ºã‚’ç¢ºå®Ÿã«ã™ã‚‹
      setTimeout(() => {
        const newContainer = document.getElementById("transcript-container");
        if (newContainer) {
          newContainer.style.display = "block";
        }
      }, 100);
    } else {
      console.log("Showing existing container...");
      container.style.display = "block";
    }

    // ç¾åœ¨ã®å†ç”Ÿä½ç½®ã«åˆã‚ã›ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
    if (player && typeof player.getCurrentTime === "function") {
      const currentTime = player.getCurrentTime();
      scrollToCurrentTime(currentTime);
    }

    // å†ç”Ÿä¸­ã§ã‚ã‚Œã°ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚’é–‹å§‹
    if (player && player.getPlayerState() === YT.PlayerState.PLAYING) {
      startTranscriptTracking();
    }
  } else {
    console.log("Closing accordion...");
    // ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã‚’é–‰ã˜ãŸã¨ãã¯ã‚³ãƒ³ãƒ†ãƒŠã‚’éè¡¨ç¤º
    if (container) {
      container.style.display = "none";
    }
    stopTranscriptTracking();
  }
}

// ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®è¿½è·¡ã‚’é–‹å§‹
function startTranscriptTracking() {
  // æ—¢å­˜ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ãŒã‚ã‚Œã°ã‚¯ãƒªã‚¢
  stopTranscriptTracking();

  // 100ãƒŸãƒªç§’ã”ã¨ã«ç¾åœ¨æ™‚é–“ã‚’ãƒã‚§ãƒƒã‚¯
  timeUpdateInterval = setInterval(() => {
    if (player && typeof player.getCurrentTime === "function") {
      const currentTime = player.getCurrentTime();
      updateTranscriptHighlight(currentTime);
    }
  }, 100);
}

// ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®è¿½è·¡ã‚’åœæ­¢
function stopTranscriptTracking() {
  if (timeUpdateInterval) {
    clearInterval(timeUpdateInterval);
    timeUpdateInterval = null;
  }
}

// ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’æ›´æ–°
function updateTranscriptHighlight(currentTime) {
  // ç¾åœ¨ã®æ™‚é–“ã«å¯¾å¿œã™ã‚‹ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã‚’æ¢ã™
  let activeIndex = -1;
  for (let i = transcriptData.length - 1; i >= 0; i--) {
    if (currentTime >= transcriptData[i].seconds) {
      activeIndex = i;
      break;
    }
  }

  // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¢ã‚¤ãƒ†ãƒ ãŒå¤‰ã‚ã£ãŸå ´åˆã®ã¿æ›´æ–°
  if (activeIndex !== currentTranscriptIndex && activeIndex !== -1) {
    currentTranscriptIndex = activeIndex;
    highlightTranscriptItem(activeIndex);
    scrollToTranscriptItem(activeIndex);
  }
}

// ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
function highlightTranscriptItem(index) {
  // ã™ã¹ã¦ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’å‰Šé™¤
  document.querySelectorAll(".transcript-item").forEach((item) => {
    item.classList.remove("active");
  });

  // æŒ‡å®šã•ã‚ŒãŸã‚¢ã‚¤ãƒ†ãƒ ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
  const activeItem = document.querySelector(
    `.transcript-item[data-index="${index}"]`,
  );
  if (activeItem) {
    activeItem.classList.add("active");
  }
}

// ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
function scrollToTranscriptItem(index) {
  const activeItem = document.querySelector(
    `.transcript-item[data-index="${index}"]`,
  );
  const container = document.getElementById("transcript-box");

  if (activeItem && container) {
    // ã‚¹ãƒ ãƒ¼ã‚ºã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
    const itemTop = activeItem.offsetTop;
    const containerHeight = container.clientHeight;
    const itemHeight = activeItem.clientHeight;

    // ã‚¢ã‚¤ãƒ†ãƒ ã‚’ä¸­å¤®ã«é…ç½®
    const scrollPosition = itemTop - containerHeight / 2 + itemHeight / 2;

    container.scrollTo({
      top: scrollPosition,
      behavior: "smooth",
    });
  }
}

// æŒ‡å®šæ™‚é–“ã«å¯¾å¿œã™ã‚‹ä½ç½®ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
function scrollToCurrentTime(seconds) {
  for (let i = transcriptData.length - 1; i >= 0; i--) {
    if (seconds >= transcriptData[i].seconds) {
      highlightTranscriptItem(i);
      scrollToTranscriptItem(i);
      currentTranscriptIndex = i;
      break;
    }
  }
}

// ============================================
// ãƒãƒ£ãƒ—ã‚¿ãƒ¼ãƒªã‚¹ãƒˆé–¢é€£ï¼ˆæ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ï¼‰
// ============================================

// æ™‚é–“æ–‡å­—åˆ— (HH:MM:SS or MM:SS) ã‚’ç§’ã«å¤‰æ›ã™ã‚‹é–¢æ•°
function timeToSeconds(timeString) {
  const parts = timeString.split(":").map(Number);
  let seconds = 0;
  if (parts.length === 3) {
    // HH:MM:SS
    seconds = parts[0] * 3600 + parts[1] * 60 + parts[2];
  } else if (parts.length === 2) {
    // MM:SS
    seconds = parts[0] * 60 + parts[1];
  }
  return seconds;
}

// ãƒãƒ£ãƒ—ã‚¿ãƒ¼ãƒªã‚¹ãƒˆã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®šã™ã‚‹é–¢æ•°
function setupChapterClickEvents() {
  console.log("Setting up chapter click events."); // ãƒ­ã‚°è¿½åŠ 
  const chapterListElement = document.getElementById("chapter-list");
  let text = chapterListElement.innerHTML;

  if (!chapterListElement) {
    console.warn('Element with id "chapter-list" not found.');
    return;
  }

  const lines = text.split("\n").filter((line) => line.trim() !== ""); // ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡Œã”ã¨ã«åˆ†å‰²
  const chapters = [];

  // æ­£è¦è¡¨ç¾ã§ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¨ã‚¿ã‚¤ãƒˆãƒ«ã‚’æŠ½å‡º
  const regex = /^(\d{1,2}:\d{2}(?::\d{2})?)\s+(.+)$/;

  lines.forEach((line) => {
    const match = line.trim().match(regex);
    if (match) {
      const time = match[1]; // æ™‚é–“æ–‡å­—åˆ— (ä¾‹: '1:15')
      const title = match[2]; // ã‚¿ã‚¤ãƒˆãƒ« (ä¾‹: 'ãƒˆãƒ”ãƒƒã‚¯A')
      const seconds = timeToSeconds(time); // ç§’ã«å¤‰æ› (ä¾‹: 75)
      chapters.push({ time, title, seconds });
    }
  });

  if (chapters.length === 0) {
    chapterListElement.innerHTML =
      "<p>ãƒãƒ£ãƒ—ã‚¿ãƒ¼æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>";
    return;
  }

  // ç›®æ¬¡ãƒªã‚¹ãƒˆã®HTMLã‚’ç”Ÿæˆ
  const ul = document.createElement("ul");
  chapters.forEach((chapter) => {
    const li = document.createElement("li");
    li.textContent = `${chapter.time} ${chapter.title}`;
    li.setAttribute("data-seconds", chapter.seconds); // ç§’æ•°ã‚’dataå±æ€§ã¨ã—ã¦ä¿æŒ
    li.addEventListener("click", handleChapterClick);
    ul.appendChild(li);
  });
  chapterListElement.innerHTML = ""; // å¤ã„å†…å®¹ã‚’ã‚¯ãƒªã‚¢
  chapterListElement.appendChild(ul); // ç”Ÿæˆã—ãŸãƒªã‚¹ãƒˆã‚’è¿½åŠ 
}

// ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒãƒ³ãƒ‰ãƒ©é–¢æ•°
function handleChapterClick(event) {
  const chapter = event.currentTarget; // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸliè¦ç´ 
  const seconds = chapter.getAttribute("data-seconds");

  if (seconds === null) {
    console.warn(
      "Clicked item is missing data-seconds attribute:",
      chapter.textContent,
    );
    return;
  }

  console.log(
    `Chapter clicked: ${chapter.textContent.trim()}, seeking to ${seconds}s`,
  ); // ãƒ­ã‚°è¿½åŠ 

  // playerã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨seekToãƒ¡ã‚½ãƒƒãƒ‰ã®å­˜åœ¨ã‚’ç¢ºèª
  if (player && typeof player.seekTo === "function") {
    player.seekTo(seconds, true); // æŒ‡å®šç§’æ•°ã«ç§»å‹•ã—ã€å†ç”Ÿã‚’é–‹å§‹

    // ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚‚åŒæœŸ
    scrollToCurrentTime(seconds);
  } else {
    console.error(
      "Player is not ready or seekTo function is unavailable when clicking chapter.",
    );
  }
}

// ============================================
// CSS ã‚¹ã‚¿ã‚¤ãƒ«ã®è¿½åŠ 
// ============================================
const style = document.createElement("style");
style.textContent = `
 #transcript-container {
    margin-top: 20px;
  }

  #transcript-box {
    height: 400px;
    overflow-y: auto;
    border: 1px solid #ddd;
    padding: 20px;
    border-radius: 8px;
    position: relative;
  }

  .transcript-item {
    margin-bottom: 15px;
    padding: 10px;
    border-radius: 4px;
    transition: background-color 0.3s ease;
    line-height: 1.6;
    cursor: pointer;
  }

  .transcript-item:hover {
  }

  .transcript-item.active {;
    font-weight: bold;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .transcript-time {
    color: #666;
    font-size: 0.9em;
    margin-right: 10px;
    font-weight: normal;
  }

  .transcript-accordion {
    margin-top: 20px;
  }

  .transcript-accordion summary {
    cursor: pointer;
    padding: 10px;
    border-radius: 4px;
    font-weight: bold;
  }

  .transcript-accordion summary:hover {
    opacity: 0.8;
  }

  /* ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚½ãƒ¼ã‚¹ã‚’éè¡¨ç¤ºã«ã™ã‚‹ */
  #transcript-source {
    display: none;
  }
`;
document.head.appendChild(style);

</script>}
</body>